<div class="flex w-full h-full">
  <div class="flex flex-col bg-gray shadow-md h-full p-2 w-[28%]">
    <input
      type="text"
      placeholder="Search notes..."
      class="w-full px-2 py-1 border focus:outline-none text-xs 2xl:text-sm 3xl:text-base border-black/30"
      (input)="onSearch($event)"
    />

    <div
      class="flex flex-col gap-2 mt-2 overflow-y-scroll"
      cdkDropList
      id="backlog"
      #backlogList="cdkDropList"
      [cdkDropListData]="backlogCards"
      [cdkDropListConnectedTo]="[displayList]"
      (cdkDropListDropped)="drop($event)"
    >
      @for (card of backlogCards; track card) {
        <div class="bg-white shadow-md rounded-md p-2 cursor-move" cdkDrag>
          <div
            class="bg-black/10 h-full w-full border-dotted border-2 border-black/30 min-h-[100px] transition-all duration-200"
            *cdkDragPlaceholder
          ></div>
          <div
            *cdkDragPreview
            class="opacity-50 bg-white border-2 border-black/30 rounded-md p-2 max-w-[28%]"
          >
            <p class="text-xs 2xl:text-sm 3xl:text-base">{{ card.text }}</p>
            <p class="text-xs 2xl:text-sm 3xl:text-base text-black/50 mt-1">
              {{ card.classification }}
            </p>
          </div>
          <p class="text-xs 2xl:text-sm 3xl:text-base">{{ card.text }}</p>
          <p class="text-xs 2xl:text-sm 3xl:text-base text-black/50 mt-1">
            {{ card.classification }}
          </p>
        </div>
      }
    </div>
  </div>
  <div class="flex flex-col h-full p-2 w-[72%]">
    <div
      class="flex flex-col gap-2 overflow-y-scroll overflow-x-hidden min-h-[200px]"
      cdkDropList
      #displayList="cdkDropList"
      id="display"
      [cdkDropListData]="displayCards"
      [cdkDropListConnectedTo]="[backlogList]"
      (cdkDropListDropped)="drop($event)"
    >
      @if (displayCards.length > 0) {
        @for (card of displayCards; track card) {
          <div
            class="shadow-md rounded-md p-2 cursor-move border border-transparent"
            [class.!border-[#333]]="card === selectedCard"
            cdkDrag
            [style.backgroundColor]="getPastelColor($index)"
            (click)="selectCard(card)"
          >
            <div
              class="bg-black/10 h-full w-full border-dotted border-2 border-black/30 min-h-[200px] transition-all duration-200"
              *cdkDragPlaceholder
            ></div>
            <div class="flex justify-between">
              <p class="text-xs 2xl:text-sm 3xl:text-base text-black/50 mt-1">
                {{ card.classification }}
              </p>
              <button
                mat-icon-button
                class="compact-icon"
                [matMenuTriggerFor]="cardMenu"
                (click)="$event.stopPropagation()"
              >
                <mat-icon>more_vert</mat-icon>
              </button>
            </div>
            <p class="text-xs 2xl:text-sm 3xl:text-base">{{ card.text }}</p>
          </div>
        }
      } @else {
        <div class="flex flex-col justify-center items-center relative">
          @if (currentTitle) {
            <p
              class="text-xs 2xl:text-sm 3xl:text-base text-black/50 mt-40 absolute top-[0]"
            >
              Legen Sie zur Erzeugung einer Tätigkeitsdarstellung hier
              Arbeitsvorgänge ab.
            </p>
          } @else {
            <p
              class="cursor-pointer text-xs 2xl:text-sm 3xl:text-base text-black/50 mt-40 absolute top-[0]"
              (click)="openCreateDialog()"
            >
              Neue Tätigkeitsdarstellung erzeugen
            </p>
          }
        </div>
      }
    </div>
  </div>
</div>

<mat-menu #cardMenu="matMenu" class="custom-menu">
  <button mat-menu-item (click)="emitAlert()">Nach oben verschieben</button>
  <button mat-menu-item (click)="emitAlert()">Nach unten verschieben</button>
  <mat-divider></mat-divider>
  <button mat-menu-item (click)="emitAlert()">Editieren</button>
  <mat-divider></mat-divider>
  <button mat-menu-item (click)="emitAlert()" class="!text-red-500">
    Entfernen
  </button>
</mat-menu>
